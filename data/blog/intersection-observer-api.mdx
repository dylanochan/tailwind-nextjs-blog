---
title: 'Intersection Observer API'
date: '2025-09-30'
tags: ['Intersection Observer API', 'Echarts']
draft: true
images: []
summary: ä¸ºäº†è®©å¼¹çª—ä¸­ Echarts å›¾è¡¨åœ¨æ‰“å¼€æ—¶é‡æ–°é€‚åº”ç›’å­å¤§å°ï¼Œå‘ç°äº† Intersection Observer API è¿™ä¸ª API å¯ä»¥ç›‘å¬å…ƒç´ æ˜¯å¦å‡ºç°åœ¨å¯è§†åŒºåŸŸã€‚
---

é—®é¢˜æ˜¯è¿™æ ·çš„ï¼Œåœ¨ä¸€ä¸ªå¼¹çª—ä¸­ï¼Œæœ‰ä¸€ä¸ª Echarts å›¾è¡¨ï¼Œå¹¶ä¸”ç»‘å®šäº†ä¸€ä¸ª resizeï¼š
``` javascript
window.addEventListener('resize', async function () {
				await chartSize(outerRef.value, document.getElementById(props.chartId))
				chartRef.value.resize()
				updateChartOption()
			})
```
åœ¨å¼¹çª—æ‰“å¼€çš„æ—¶å€™ï¼Œå¼¹çª—ä¸­çš„å›¾è¡¨ä¼šè‡ªåŠ¨é‡æ–°é€‚åº”ç›’å­å¤§å°æ­£å¸¸å·¥ä½œï¼›ä½†æ˜¯å½“å¼¹çª—å…³é—­æ—¶ï¼Œå¦‚æœé¡µé¢å‘ç”Ÿäº† resizeï¼Œç”±äºå¼¹çª—æœªæ‰“å¼€ï¼Œç›’å­çš„å¤§å°æ˜¯ä¸ç¡®å®šçš„ï¼Œé‚£ä¹ˆå›¾è¡¨çš„resizeä¹Ÿæ˜¯é”™è¯¯çš„ã€‚
åˆ™éœ€è¦åœ¨å¼¹çª—æ‰“å¼€çš„æ—¶å€™ä¹Ÿé‡æ–°è°ƒç”¨ä¸€ä¸‹å›¾è¡¨çš„resizeæ–¹æ³•ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å°±å’Œå¼¹çª—çš„çŠ¶æ€ç»‘å®šï¼Œä¸å¤Ÿè§£è€¦ã€‚ä½¿ç”¨ Intersection Observer API æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„è§£å†³æ–¹å¼ã€‚

> IntersectionObserver æ¥å£ï¼ˆä»å±äº Intersection Observer APIï¼‰æä¾›äº†ä¸€ç§å¼‚æ­¥è§‚å¯Ÿç›®æ ‡å…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–é¡¶çº§æ–‡æ¡£è§†å£ï¼ˆviewportï¼‰äº¤å‰çŠ¶æ€çš„æ–¹æ³•ã€‚å…¶ç¥–å…ˆå…ƒç´ æˆ–è§†å£è¢«ç§°ä¸ºæ ¹ï¼ˆrootï¼‰ã€‚

> å½“ä¸€ä¸ª IntersectionObserver å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå…¶è¢«é…ç½®ä¸ºç›‘å¬æ ¹ä¸­ä¸€æ®µç»™å®šæ¯”ä¾‹çš„å¯è§åŒºåŸŸã€‚ä¸€æ—¦ IntersectionObserver è¢«åˆ›å»ºï¼Œåˆ™æ— æ³•æ›´æ”¹å…¶é…ç½®ï¼Œæ‰€ä»¥ä¸€ä¸ªç»™å®šçš„è§‚å¯Ÿè€…å¯¹è±¡åªèƒ½ç”¨æ¥ç›‘å¬å¯è§åŒºåŸŸçš„ç‰¹å®šå˜åŒ–å€¼ï¼›ç„¶è€Œï¼Œä½ å¯ä»¥åœ¨åŒä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡ä¸­é…ç½®ç›‘å¬å¤šä¸ªç›®æ ‡å…ƒç´ ã€‚

è¿™ä¸ªæ¥å£å®˜æ–¹è¯´æ˜å…¶å®æ˜¯æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸ä¸Šçº§å…ƒç´ çš„é‡åˆç‡ï¼Œä½†æ˜¯å½“ä½ æŠŠä¸Šçº§å…ƒç´ è®¾ç½®ä¸º nullï¼ˆå³é»˜è®¤çš„é¡¶çº§æ–‡æ¡£è§†å£ï¼‰çš„æ—¶å€™ï¼Œå°±èƒ½è¾¾åˆ°æ£€æµ‹è¿™ä¸ªå…ƒç´ å‡ºç°åœ¨å¯è§†åŒºåŸŸçš„æ¯”ç‡çš„æ•ˆæœã€‚

> æ³¨æ„ï¼ŒIEä¸æ”¯æŒï¼Œä¸è¿‡åº”è¯¥å½±å“ä¸å¤§å§ ğŸ˜ŒğŸ˜Œ

## ä½¿ç”¨æ–¹æ³•

```javascript
const intersectionObserver  = new IntersectionObserver(callback, options);
```
callback:
   - entriesï¼šä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å¯è§å…ƒç´ ã€‚
   - observerï¼šå½“å‰ IntersectionObserver å¯¹è±¡ã€‚

options:
   - rootï¼šæŒ‡å®šæ ¹å…ƒç´ ï¼Œé»˜è®¤ä¸º nullï¼Œè¡¨ç¤ºä½¿ç”¨é¡¶çº§æ–‡æ¡£è§†å£ã€‚
   - rootMarginï¼šæŒ‡å®šæ ¹å…ƒç´ çš„è¾¹æ¡†ï¼Œé»˜è®¤ä¸º 0px 0px 0px 0pxã€‚
   - thresholdï¼šæŒ‡å®šå¯è§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º 0ã€‚

ä»£ç ç¤ºä¾‹ï¼š
```javascript
const handleIntersection = async (entries, observer) => {
		for (const entry of entries) {
			if (entry.isIntersecting) {
				await nextTick()
				await chartSize(outerRef.value, document.getElementById(props.chartId))
				chartRef.value.clear()
				chartRef.value.resize()
				updateChartOption()
			}
		}
	}
	const observeElement = (el) => {
		const options = {
			root: null, // ä½¿ç”¨ viewport ä½œä¸ºæ ¹å…ƒç´ 
			rootMargin: '0px', // æ— é¢å¤–çš„è¾¹è·
			threshold: 0.1 // å½“å…ƒç´ è‡³å°‘æœ‰ 10% è¿›å…¥è§†å›¾æ—¶è§¦å‘
		}
		const observer = new IntersectionObserver(handleIntersection, options)
		if (el) {
			observer.observe(el)
		}
		return () => {
			if (el) {
				observer.unobserve(el)
			}
		}
	}
```
## ä¸»è¦ç”¨é€”
è¿™ä¸ª API çš„ç”¨é€”è¿˜æŒºå¤šçš„ï¼š
### 1. æ— é™æ»šåŠ¨
ä¹‹å‰å®ç°æ»šåŠ¨ç›‘å¬çš„æ–¹å¼ä¸»è¦æ˜¯ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œä½†æ˜¯è¿™æ ·ä¼šå­˜åœ¨ä¸€å®šçš„æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæ¯æ¬¡æ»šåŠ¨éƒ½ä¼šè§¦å‘ä¸€æ¬¡äº‹ä»¶ï¼Œå¯¼è‡´é¡µé¢æ€§èƒ½ä¸‹é™ï¼Œå¹¶ä¸”è¿˜éœ€è¦æ‰‹åŠ¨è®¡ç®—å„ç§æ»šåŠ¨ä½ç½®è¿˜æœ‰é«˜åº¦ã€‚
ç”¨è¿™ä¸ªApiå°±å¾ˆæ–¹ä¾¿äº†ï¼Œåªéœ€è¦åœ¨é¡µé¢æœ€ä¸‹é¢çš„å…ƒç´ ç»‘å®šä¸€ä¸ªäº¤å‰ç›‘å¬å³å¯ï¼Œæ»‘åŠ¨åˆ°æœ€ä¸‹é¢å°±åŠ è½½æ›´å¤šçš„æ•°æ®å³å¯ã€‚
```javascript
const intersectionObserver = new IntersectionObserver((entries) => {
// å¦‚æœ intersectionRatio ä¸º 0ï¼Œåˆ™ç›®æ ‡åœ¨è§†é‡å¤–ï¼Œ
// æˆ‘ä»¬ä¸éœ€è¦åšä»»ä½•äº‹æƒ…ã€‚
if (entries[0].intersectionRatio <= 0) return;

loadItems(10);
console.log("Loaded new items");
});
// å¼€å§‹ç›‘å¬
intersectionObserver.observe(document.querySelector(".scrollerFooter"));
```
### 2. å›¾ç‰‡æ‡’åŠ è½½
è¿™ä¸ª API å¯ä»¥å®ç°å›¾ç‰‡æ‡’åŠ è½½ï¼Œå½“å›¾ç‰‡å‡ºç°åœ¨å¯è§†åŒºåŸŸæ—¶ï¼Œæ‰åŠ è½½å›¾ç‰‡ã€‚
```javascript
const intersectionObserver = new IntersectionObserver((entries) => {
    if (item.isIntersecting)  {
        loadImage(image);
    }
})
// ç›‘å¬å›¾ç‰‡å…ƒç´ 
intersectionObserver.observe(image);
```

## å…¶ä»–ç±»ä¼¼çš„API
1. [MutationObserver](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver)ï¼šMutationObserver æ¥å£å…è®¸å¼€å‘è€…è§‚å¯ŸDOMæ ‘å¯¹æŸä¸ªå…ƒç´ æˆ–å­å…ƒç´ çš„å˜åŒ–ã€‚
2. [ResizeObserver](https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver)ï¼šResizeObserver æ¥å£å…è®¸å¼€å‘è€…è§‚å¯Ÿç›®æ ‡å…ƒç´ æˆ–æ ¹å…ƒç´ å°ºå¯¸çš„å˜åŒ–ã€‚
